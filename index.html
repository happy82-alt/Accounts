<!DOCTYPE<!<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>GameVault ‚Äì Game Account Marketplace</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(to right, #1e3c72, #2a5298);
      color: #fff;
    }

    nav {
      background: #111;
      padding: 15px;
      display: flex;
      justify-content: center;
    }

    nav button {
      margin: 0 10px;
      padding: 10px 20px;
      background: #0284C7;
      border: none;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }

    nav button:hover {
      background: #0369A1;
    }

    .section {
      display: none;
      max-width: 900px;
      margin: 30px auto;
      background: #ffffff10;
      padding: 20px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
    }

    .active {
      display: block;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 4px;
    }

    button.action {
      background: #34D399;
      margin-top: 10px;
    }

    #listings .post {
      background: #ffffff20;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
    }

    .famous-games {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }

    .famous-games div {
      flex: 1 1 45%;
      background: #ffffff20;
      padding: 10px;
      border-radius: 8px;
    }

    .gallery {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      margin: 10px 0;
    }

    .gallery img {
      height: 100px;
      border-radius: 5px;
    }

    video {
      width: 100%;
      max-height: 300px;
      margin-top: 10px;
      border-radius: 8px;
    }

    pre {
      white-space: pre-wrap;
      background: #00000020;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<nav>
  <button onclick="showSection('home')">üè† Home</button>
  <button onclick="showSection('marketplace')">üõí Marketplace</button>
  <button onclick="showSection('auth')">üîê Login / Register</button>
</nav>

<!-- Home Section -->
<div id="home" class="section active">
  <h2>üéÆ Welcome to GameVault</h2>
  <p>Buy and Sell Game Accounts in one place.</p>
  <h3>üî• Famous Games</h3>
  <div class="famous-games">
    <div><strong>PUBG Mobile</strong><br>Battle Royale, FPS</div>
    <div><strong>Free Fire</strong><br>Battle Royale, Fast Action</div>
    <div><strong>World of Tanks</strong><br>Tank Battles</div>
    <div><strong>War Machines</strong><br>Tank PvP</div>
    <div><strong>Call of Duty Mobile</strong><br>Shooter & Battle Royale</div>
    <div><strong>Fortnite</strong><br>Battle Royale, Creative</div>
    <div><strong>Shadowgun Legends</strong><br>Online RPG Shooter</div>
    <div><strong>Pixel Gun 3D</strong><br>FPS with skins & modes</div>
  </div>
</div>
<!-- Marketplace Section -->
<div id="marketplace" class="section">
  <h2>üõí Marketplace</h2>

  <!-- Post form (shown only when logged in) -->
  <div id="post-box" style="display:none;">
    <h3>Post Your Game Account</h3>
    <input type="text" id="gameTitle" placeholder="Game Title" required>
    <textarea id="description" placeholder="Description" required></textarea>
    <input type="number" id="price" placeholder="Price (USD)" required>
    
    <label>Upload Images (required):</label>
    <input type="file" id="images" accept="image/*" multiple required>

    <label>Upload Video (optional):</label>
    <input type="file" id="video" accept="video/*">

    <input type="email" id="contactEmail" placeholder="Contact Email" required>
    <input type="text" id="contactPhone" placeholder="Contact Phone (e.g. +966...)" required>

    <textarea id="privateDetails" placeholder="Private Login Details (email/pass, skins, etc)" required></textarea>

    <button class="action" onclick="createPost()">Post Account</button>
  </div>

  <!-- Listings -->
  <div id="listings"></div>
</div>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDYSOFzd9SK0XrVnaUfVCRawLCJFD3GijI",
    authDomain: "web-game-f7c50.firebaseapp.com",
    projectId: "web-game-f7c50",
    storageBucket: "web-game-f7c50.appspot.com",
    messagingSenderId: "769692641635",
    appId: "1:769692641635:web:94cf1c9f7ff5aa77a3cb56"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    currentUser = user;
    document.getElementById("post-box").style.display = user ? "block" : "none";
    loadPosts();
  });

  function register() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const nickname = document.getElementById("nickname").value;
    auth.createUserWithEmailAndPassword(email, password)
      .then((cred) => db.collection("users").doc(cred.user.uid).set({ nickname }))
      .then(() => alert("‚úÖ Registered!"))
      .catch(err => alert("‚ùå " + err.message));
  }

  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => alert("‚úÖ Logged in!"))
      .catch(err => alert("‚ùå " + err.message));
  }

  function logout() {
    auth.signOut();
  }

  async function createPost() {
    if (!currentUser) return alert("Please log in first.");
    
    const title = document.getElementById("gameTitle").value;
    const description = document.getElementById("description").value;
    const price = parseFloat(document.getElementById("price").value);
    const privateDetails = document.getElementById("privateDetails").value;
    const contactEmail = document.getElementById("contactEmail").value;
    const contactPhone = document.getElementById("contactPhone").value;
    const imageFiles = document.getElementById("images").files;
    const videoFile = document.getElementById("video").files[0];

    if (!title || !description || !price || !privateDetails || !contactEmail || !contactPhone || imageFiles.length === 0) {
      alert("‚ö†Ô∏è Please fill all required fields and upload at least one image.");
      return;
    }

    const nicknameDoc = await db.collection("users").doc(currentUser.uid).get();
    const nickname = nicknameDoc.data().nickname;

    // Upload images
    const imageUrls = [];
    for (let i = 0; i < imageFiles.length; i++) {
      const ref = storage.ref().child("images/" + Date.now() + "_" + imageFiles[i].name);
      await ref.put(imageFiles[i]);
      const url = await ref.getDownloadURL();
      imageUrls.push(url);
    }

    // Upload video
    let videoUrl = "";
    if (videoFile) {
      const videoRef = storage.ref().child("videos/" + Date.now() + "_" + videoFile.name);
      await videoRef.put(videoFile);
      videoUrl = await videoRef.getDownloadURL();
    }

    await db.collection("posts").add({
      title, description, price, privateDetails,
      contactEmail, contactPhone,
      imageUrls, videoUrl,
      nickname,
      uid: currentUser.uid,
      createdAt: new Date(),
      buyerUID: null
    });

    alert("‚úÖ Post created!");
    loadPosts();
  }

  function loadPosts() {
    const listings = document.getElementById("listings");
    listings.innerHTML = "Loading...";

    db.collection("posts").orderBy("createdAt", "desc").get().then(snapshot => {
      listings.innerHTML = "";
      snapshot.forEach(doc => {
        const post = doc.data();
        const id = doc.id;

        const div = document.createElement("div");
        div.className = "post";

        // Image gallery
        let galleryHtml = "";
        if (post.imageUrls && post.imageUrls.length) {
          galleryHtml = `<div class="gallery">` + post.imageUrls.map(url => `<img src="${url}">`).join("") + `</div>`;
        }

        // Optional video
        let videoHtml = "";
        if (post.videoUrl) {
          videoHtml = `
            <video controls>
              <source src="${post.videoUrl}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          `;
        }

        let postHtml = `
          <h4>${post.title} ‚Äì $${post.price}</h4>
          ${galleryHtml}
          ${videoHtml}
          <p>${post.description}</p>
          <small>Posted by: <strong>${post.nickname}</strong></small><br><br>
        `;

        if (post.buyerUID === currentUser?.uid) {
          postHtml += `
            <strong>‚úÖ Purchase Confirmed</strong><br>
            <pre>${post.privateDetails || 'No login details'}</pre>
            <p>üìß ${post.contactEmail} | üì± ${post.contactPhone}</p>
          `;
        } else if (post.buyerUID && post.buyerUID !== currentUser?.uid) {
          postHtml += `<em>‚ö†Ô∏è Already Sold</em>`;
        } else if (currentUser) {
          postHtml += `
            <p>üìß ${post.contactEmail} | üì± ${post.contactPhone}</p>
            <button class="action" onclick="buyPost('${id}')">Buy Now</button>
          `;
        } else {
          postHtml += `<small>üîê Login to buy</small>`;
        }

        div.innerHTML = postHtml;
        listings.appendChild(div);
      });
    });
  }

  function buyPost(postId) {
    if (!currentUser) return alert("Login first.");
    const confirmed = confirm("Confirm purchase? You will see private login details.");
    if (!confirmed) return;
    db.collection("posts").doc(postId).update({
      buyerUID: currentUser.uid
    }).then(() => {
      alert("‚úÖ Purchase complete!");
      loadPosts();
    });
  }

  function showSection(id) {
    document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }
</script>
