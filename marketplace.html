function loadMarketplace() {
  const listingsDiv = document.getElementById("listings");
  listingsDiv.innerHTML = "Loading...";

  db.collection("posts").orderBy("createdAt", "desc").get().then(snapshot => {
    listingsDiv.innerHTML = "";
    if (snapshot.empty) {
      listingsDiv.innerHTML = "<p>No listings available.</p>";
      return;
    }

    snapshot.forEach(doc => {
      const post = doc.data();
      const id = doc.id;

      const div = document.createElement("div");
      div.className = "listing";

      // Image gallery
      let imagesHtml = "";
      if (post.imageUrls && Array.isArray(post.imageUrls)) {
        imagesHtml = `<div style="display: flex; overflow-x: auto; gap: 10px;">` +
          post.imageUrls.map(url => `<img src="${url}" alt="Account Image" style="height:100px; border-radius:5px;">`).join("") +
          `</div><br>`;
      }

      // Optional video
      let videoHtml = "";
      if (post.videoUrl) {
        videoHtml = `
          <video controls style="width: 100%; max-height: 300px; margin-top: 10px; border-radius: 8px;">
            <source src="${post.videoUrl}" type="video/mp4">
            Your browser does not support the video tag.
          </video>`;
      }

      let content = `
        <h3>${post.title} ‚Äì $${post.price}</h3>
        ${imagesHtml}
        ${videoHtml}
        <p>${post.description}</p>
        <small>Posted by: ${post.nickname}</small><br><br>
      `;

      if (post.buyerUID === currentUser?.uid) {
        content += `
          <strong>‚úÖ Purchase Confirmed</strong><br>
          <p><strong>Login Info:</strong><br><pre style="white-space: pre-wrap;">${post.privateDetails || 'None'}</pre></p>
          <p><strong>Contact:</strong> ${post.contactEmail || 'No email'} | üì± ${post.contactPhone || 'No phone'}</p>
        `;
      } else if (post.buyerUID && post.buyerUID !== currentUser?.uid) {
        content += `<p><em>‚ö†Ô∏è This account is already sold.</em></p>`;
      } else if (currentUser) {
        content += `
          <p><strong>Contact:</strong> ${post.contactEmail || 'N/A'} | üì± ${post.contactPhone || 'N/A'}</p>
          <button class="buy-btn" onclick="confirmPurchase('${id}')">Buy Now</button>
        `;
      } else {
        content += `<small>üîê Login to buy</small>`;
      }

      div.innerHTML = content;
      listingsDiv.appendChild(div);
    });
  });
}
